{% extends ':site:base.html.twig' %}
{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('css/grid.css') }}" media="all" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <style type="text/css">

        .mapael .map {
            margin-bottom: 10px;
            position: relative;
        }

        .map-container a {
            text-decoration: none;
        }

        .city-link {
            line-height: 1.909em;
            font-size: 1.46em;
        }
    </style>
{% endblock %}
{% block javascripts %}
    {{ parent() }}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-mousewheel/3.1.13/jquery.mousewheel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/raphael/2.2.0/raphael-min.js"></script>
    <script src="{{ asset('/js/jQuery-Mapael-2.0.0/js/jquery.mapael.min.js') }}"></script>
    <script src="{{ asset('/js/jQuery-Mapael-2.0.0/js/maps/france_and_luxembourg.min.js') }}"></script>


    <script>
        var legends = {};
        var plots = {};
        var baseArea = {
            attrs: {
                fill: "#2b3e74"
            },
            attrsHover: {
                fill: "#2b3e74"
            }
        };
        var areas = {};

        $('.afup-office').each(function() {
            var city = $(this);
            var href = $('a', city).first().attr('href');

            legends[city.data('mapKey')] = {
                first_point_x: city.data("map-legend-first-point-x"),
                first_point_y: city.data("map-legend-first-point-y"),
                second_point_x: city.data("map-legend-second-point-x"),
                second_point_y: city.data("map-legend-second-point-y"),
                third_point_x: city.data("map-legend-third-point-x"),
                third_point_y: city.data("map-legend-third-point-y"),
                attachment: city.data("map-legend-attachment"),
                title: $('h3', city).text(),
                subtitle: city.data("map-legend-subtitle"),
                link: href,
                logo_url: $('img', city).attr('src')
            };
            plots[city.data('mapKey')] = {
                latitude: city.data("map-point-latitude"),
                longitude: city.data("map-point-longitude"),
                size: 20,
                attrs: {
                    fill: "#2b3e74"
                }
            };
            if (typeof city.data('departements') != 'undefined') {
                $.each(city.data('departements').toString().split(','), function(index, departementCode) {
                    var area = jQuery.extend({}, baseArea);
                    area["href"] = href;
                    areas["department-" + departementCode] = area;
                });
            }
            if (typeof city.data('pays') != 'undefined') {
                $.each(city.data('pays').toString().split(','), function(index, paysCode) {
                    var area = jQuery.extend({}, baseArea);
                    area["href"] = href;
                    areas["country-" + paysCode] = area;
                });
            }

        });

        $(".map-container").mapael({
            map : {
                name : "france_departments",
                defaultArea: {
                    animDuration: 0,
                    attrs: {
                        fill: "#50a0dd",
                        stroke: "#ced8d0"
                    },
                    attrsHover: {
                        fill: "#50a0dd"
                    },
                    text: {
                        attrs: {
                            fill: "#505444"
                        },
                        attrsHover: {
                            fill: "#000"
                        }
                    }
                },
                afterInit : function($self, paper, areas, plots, options) {
                    var topMargin = 30;
                    var bottomMargin = 170;
                    var leftMargin = 170;
                    var rightMargin = 100;

                    var addedWidth = leftMargin + rightMargin;
                    var addedHeight = topMargin + bottomMargin;

                    paper.setViewBox(0, 0, 600 + addedWidth, 500 + addedHeight, true);

                    // DÃ©calages de la carte
                    for (var key in areas) {
                        areas[key].mapElem.translate(addedWidth / 2, topMargin);
                    }

                    for (var key in plots) {
                        plots[key].mapElem.translate(addedWidth / 2, topMargin);
                    }

                    for (var key in legends) {
                        paper.path([
                            "M",
                            legends[key]['first_point_x'],
                            legends[key]['first_point_y'],
                            "L",
                            legends[key]['second_point_x'],
                            legends[key]['second_point_y']
                        ]).attr({stroke: "#2b3e74"});
                        paper.path([
                            "M",
                            legends[key]['second_point_x'],
                            legends[key]['second_point_y'],
                            "L",
                            legends[key]['third_point_x'],
                            legends[key]['third_point_y']
                        ]).attr({stroke: "#2b3e74"});

                        var boxWith = 150;
                        var boxHeight = 50;

                        var imageHeight = 50;
                        var imageWidth = 50;
                        var imageMargin = 4;

                        var textMaginWithImage = 8;
                        var textCentering = 23;

                        var imagePosition = {};
                        var linePoint1 = {};
                        var linePoint2 = {};
                        var textPosition = {};
                        var textAnchor;

                        if (legends[key]['attachment'] == 'left') {
                            linePoint1.x = legends[key]['third_point_x'];
                            linePoint1.y = legends[key]['third_point_y'] - (boxHeight / 2);
                            linePoint2.x = linePoint1.x;
                            linePoint2.y = linePoint1.y + boxHeight;
                            imagePosition = {
                                x: linePoint1.x + imageMargin,
                                y: linePoint1.y
                            };
                            textPosition = {
                                x: imagePosition.x + imageWidth + textMaginWithImage,
                                y: imagePosition.y + textCentering
                            };
                            textAnchor = 'start';
                        } else if (legends[key]['attachment'] == 'top') {
                            linePoint1.x = legends[key]['third_point_x'] - (boxWith / 2);
                            linePoint1.y = legends[key]['third_point_y'];
                            linePoint2.x = linePoint1.x + boxWith;
                            linePoint2.y = linePoint1.y;
                            imagePosition = {
                                x: linePoint1.x,
                                y: linePoint1.y + imageMargin
                            };
                            textPosition = {
                                x: imagePosition.x + imageWidth + textMaginWithImage,
                                y: imagePosition.y + textCentering
                            };
                            textAnchor = 'start';
                        } else if (legends[key]['attachment'] == 'bottom') {
                            linePoint1.x = legends[key]['third_point_x'] - (boxWith / 2);
                            linePoint1.y = legends[key]['third_point_y'] - boxHeight + boxHeight;
                            linePoint2.x = linePoint1.x + boxWith;
                            linePoint2.y = linePoint1.y;

                            imagePosition = {
                                x: linePoint1.x,
                                y: linePoint1.y - imageHeight - imageMargin
                            };
                            textPosition = {
                                x: imagePosition.x + imageWidth + textMaginWithImage,
                                y: imagePosition.y + textCentering
                            };
                            textAnchor = 'start';
                        } else if (legends[key]['attachment'] == 'right') {
                            linePoint1.x = legends[key]['third_point_x'] - (boxWith) + boxWith;
                            linePoint1.y = legends[key]['third_point_y'] - (boxHeight / 2);
                            linePoint2.x = linePoint1.x;
                            linePoint2.y = linePoint1.y + boxHeight;

                            imagePosition = {
                                x: linePoint1.x - imageMargin - imageWidth,
                                y: linePoint1.y
                            };
                            textPosition = {
                                x: imagePosition.x - textMaginWithImage,
                                y: imagePosition.y + textCentering
                            };
                            textAnchor = 'end';
                        }

                        paper.image(legends[key]['logo_url'], imagePosition.x, imagePosition.y, imageWidth, imageHeight);
                        var text = paper.text(textPosition.x, textPosition.y, legends[key]['title']).attr( {'text-anchor': textAnchor, 'font-size': "14px", "font-weight": "bold"} );
                        text.attr({'href': legends[key]['link']});

                    }
                }
            },
            plots: plots,
            areas: areas
        });
    </script>

{% endblock %}


{% block inner_content %}

    <h1>Antennes locales</h1>
    <p>Une dizaine d'antennes locales, reprÃ©sentantes de l'AFUP en rÃ©gion, organise rencontres, meetups et apÃ©ros PHP
        tout au long de l'annÃ©e, tisse un lien entre les dÃ©veloppeurs et fait la promotion du PHP dans les entreprises
        partout en France.</p>

    <div class="map-container">
        <div class="map">Antennes AFUP franÃ§aises</div>
    </div>


    <h2>ConcrÃ¨tement que se passe-t-il prÃ¨s de chez moi ?</h2>
    <h3>Meetups et apÃ©ros PHP</h3>
    <p>L'antenne locale organise, avec le soutien de l'AFUP, des soirÃ©es de confÃ©rences gratuites, accueillies dans des
        locaux d'entreprises partenaires : les meetups, ou rendez-vous AFUP. Les membres sont conviÃ©s Ã  assister Ã  un ou
        deux talks, proposÃ©s par des experts du langage, qu'ils soient speakers confirmÃ©s ou nouveaux confÃ©renciers qui
        se lancent en notre compagnie. <strong>Ces soirÃ©es sont l'occasion parfaite pour les auditeurs de progresser et
            se tenir informÃ© des derniÃ¨res Ã©volutions de PHP. </strong></p>
    <p>D'autres rendez-vous plus informels, organisÃ©s dans un bar autour de quelques verres, permettent Ã©galement aux
        dÃ©veloppeurs de se retrouver : pour savoir si un apÃ©ro PHP est organisÃ© prochainement prÃ¨s de chez vous,
        consultez le site des <a href="http://www.aperophp.net">apÃ©ros PHP</a>.</p>
    <h3>CrÃ©er du lien avec les entreprises, les Ã©coles et les autres associations web</h3>
    <p>L'antenne locale est l'interlocuteur de prÃ©dilection en rÃ©gion pour crÃ©er des passerelles avec les Ã©coles, les
        entreprises PHP et les autres associations web locales. <strong>GrÃ¢ce Ã  l'antenne locale, les dÃ©veloppeurs
            locaux se rencontrent, se fÃ©dÃ¨rent, et des ponts se crÃ©ent avec tous les intervenants importants du monde
            Open Source</strong>Â </p>
    <h3>Organisation d'une Ã©tape du PHP Tour</h3>
    <p>L'Ã©tape ultime pour l'antenne locale est l'organisation d'une Ã©tape du cycle de confÃ©rences itinÃ©rant de l'AFUP,
        le PHP Tour ! Quand l'Ã©quipe est dynamique, motivÃ©e, organisÃ©e, elle peut dÃ¨s lors dÃ©poser un dossier de
        candidature pour accueillir l'Ã©vÃ©nement dans sa ville.</p>
    <p>Â </p>
    <h2>Envie de vous impliquer ?</h2>
    <p>Chaque antenne locale est reprÃ©sentÃ©e par un coordinateur, Ã©lu par les membres locaux. S'il est l'interlocuteur
        privilÃ©giÃ© de l'AFUP pour votre rÃ©gion, il a cependant besoin de connaÃ®tre vos envies, vos besoins, pour
        organiser des meet-ups qui vous intÃ©resseront : contactez votre antenne, proposez votre aide, soumettez vos
        idÃ©es.<br/><strong>Envie de vous impliquer davantage ?</strong> Votre entreprise peut peut-Ãªtre accueillir un
        rendez-vous AFUP dans ses locaux, sponsoriser une soirÃ©e, ou vous pouvez peut-Ãªtre faire jouer vos contacts pour
        inviter un confÃ©rencier de qualitÃ© !</p>

    <h2>Trouvez l'antenne locale AFUP proche de chez vous !</h2>
    <p>Suivez-la sur <a href="https://twitter.com/afup/lists/antennes-afup/members?lang=fr">Twitter</a>,
        contactez-la en MP, ou Ã©crivez Ã  l'AFUP pour Ãªtre mis en relation avec le coordinateur de votre antenne.</p>

    <h2>Petite histoire des antennes locales</h2>
    <p>L'AFUP a Ã©tÃ© crÃ©Ã©e en 2000, avec pour objectif de promouvoir le langage PHP et son ecosystÃ¨me, et contribuer Ã 
        son dÃ©veloppement auprÃ¨s des professionnels et de la communautÃ©. En 2011, des membres de l'association vivant en
        rÃ©gion dÃ©cident de donner une nouvelle impulsion Ã  l'AFUP, et une nouvelle dimension Ã  ses objectifs : la
        communautÃ© manifeste son envie d'agir localement. C'est ainsi qu'apparaissent les antennes locales. Elles
        deviennent les reprÃ©sentantes en rÃ©gion de l'action menÃ©e Ã  l'Ã©chelle nationale par l'association. Rapidement,
        les antennes AFUP Lyon, Paris, OrlÃ©ans et Nantes naissent. Suivront Lille, Luxembourg, Toulouse, Valence,
        Montpellierâ¦ <strong>Rencontrez les membres AFUP qui vivent prÃ¨s de chez vous !</strong></p>


    <h2>Liste des antennes</h2>
    <div class="super-apero-officies">

        {% for office_code, office in offices %}
            <div class="container afup-office"
                data-map-key="{{ office_code }}"
                 {% if office.map is defined %}
                    data-map-legend-first-point-x="{{ office.map['legend-first-point-x'] }}"
                    data-map-legend-first-point-y="{{ office.map['legend-first-point-y'] }}"
                    data-map-legend-second-point-x="{{ office.map['legend-second-point-x'] }}"
                    data-map-legend-second-point-y="{{ office.map['legend-second-point-y'] }}"
                    data-map-legend-third-point-x="{{ office.map['legend-third-point-x'] }}"
                    data-map-legend-third-point-y="{{ office.map['legend-third-point-y'] }}"
                    data-map-legend-attachment="{{ office.map['legend-attachment'] }}"
                    data-map-point-latitude="{{ office.map['point-latitude'] }}"
                    data-map-point-longitude="{{ office.map['point-longitude'] }}"
                 {% endif %}
                 {% if office.departements is defined %}
                    data-departements="{{ office.departements|join(',') }}"
                 {% endif %}
                {% if office.pays is defined %}
                    data-pays="{{ office.pays|join(',') }}"
                {% endif %}
                {% if office.map_use_second_color is defined%}
                    data-use-second-color="1"
                {% endif %}
            >
                <div class="col-md-1">
                    <img src="{{ office.logo_url }}" />
                </div>
                <div class="col-md-3">
                    <h3>{{ office.label }}</h3>
                </div>

                <div class="col-md-2 city-link">
                    {% if office.blog_url is defined %}
                        <i class="fa fa-rss" aria-hidden="true"></i>
                        <a href="{{ office.blog_url }}">Blog</a>
                    {% endif %}
                </div>

                <div class="col-md-2 city-link">
                    {% if office.twitter is defined %}
                        <i class="fa fa-twitter" aria-hidden="true"></i>
                        <a href="https://twitter.com/{{ office.twitter }}">Twitter</a>
                    {% endif %}
                </div>

                <div class="col-md-4 city-link">
                    {% if office.meetup_urlname is defined %}
                        <i class="fa fa-meetup" aria-hidden="true"></i>
                        <a href="https://www.meetup.com/fr-FR/{{ office.meetup_urlname }}/">Meetup</a>
                    {% endif %}
                </div>
            </div>
        {% endfor %}
    </div>

    <a class="twitter-timeline" data-lang="fr" data-height="500" data-dnt="true" data-theme="light" href="https://twitter.com/afup/lists/antennes-afup">A Twitter List by afup</a>
    <script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>

{% endblock %}
