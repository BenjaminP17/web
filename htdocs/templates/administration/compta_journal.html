{if $action == 'lister' || $action == 'debit' || $action == 'credit' }

    <h2>Journal</h2>

    <div class="ui menu">
        <a href="index.php?page=compta_journal&amp;action=ajouter" class="item">
            <div data-tooltip="Ajouter une écriture" data-position="bottom left">
                <i class="icon plus square"></i>
                Ajouter
            </div>
        </a>
        <a href="index.php?page=compta_journal&amp;action=importer" class="item">
            <i class="icon upload"></i>
            Importer un fichier CSV
        </a>
    </div>

    <div class="ui green segment">
        <form method="GET" name="forum">
            <input type="hidden" name="page" value="compta_journal" />
            <div class="ui form">
                <div class="inline fields">
                    <div class="field">
                        <label>Année comptable</label>
                        <select name="id_periode" onchange="this.form.submit(); return false;">
                            {foreach from=$listPeriode item=periode}
                            <option value="{$periode.id}"{if $id_periode == $periode.id} selected{/if}>{$periode.date_debut} - {$periode.date_fin}</option>
                            {/foreach}
                        </select>
                    </div>
                </div>
            </div>
        </form>
    </div>

    <div class="ui menu">
        <a href="index.php?page=compta_journal&amp;action=export&id_periode={$smarty.get.id_periode}" class="item">
            <i class="icon file"></i>
            Exporter la période en CSV
        </a>
    </div>

    <div class="ui top attached tabular menu">
        <a class="item {if $action == 'lister'}active{/if}" href="index.php?page=compta_journal&amp;action=lister&id_periode={$smarty.get.id_periode}">Dépenses/Recettes</a>
        <a class="item {if $action == 'debit'}active{/if}" href="index.php?page=compta_journal&amp;action=debit&id_periode={$smarty.get.id_periode}">Dépenses</a>
        <a class="item {if $action == 'credit'}active{/if}" href="index.php?page=compta_journal&amp;action=credit&id_periode={$smarty.get.id_periode}">Recettes</a><br />
    </div>

    <div class="ui bottom attached segment">
    <table class="ui table striped compact celled tab--filterable">
        <tr>
            <!-- th width="20px">&nbsp;</th -->
           <th><a href="index.php?page=compta_journal&amp;tri=date_consultation&amp;sens={if $smarty.get.sens == 'asc' && $smarty.get.tri == 'date_consultation'}desc{else}asc{/if}">Date</a></th>
            <th>Compte</th>
           <th><a href="index.php?page=compta_journal&amp;tri=evenement&amp;sens={if $smarty.get.sens == 'asc' && $smarty.get.tri == 'date_consultation'}desc{else}asc{/if}">Evenement</a></th>
           <th><a href="index.php?page=compta_journal&amp;tri=categorie&amp;sens={if $smarty.get.sens == 'asc' && $smarty.get.tri == 'date_consultation'}desc{else}asc{/if}">Catégorie</a></th>
            <th>Description</th>
            <th>Debit</th>
            <th>Crédit</th>
            <th>Reglement</th>
            <th>Justif ?</th>
            <th>&nbsp;</th>
       </tr>
    {foreach from=$journal item=ecriture}
         <tr class="{cycle values="odd,even"}" id="journal-ligne-{$ecriture.idtmp}">
            <!-- td width="20px"><input type="checkbox" value=""/></td -->
            <td nowrap="nowrap"><a name="L{$ecriture.idtmp}"></a>{$ecriture.date_ecriture|date_format:"%d/%m/%Y"}</td>
            <td>{$ecriture.nom_compte}</td>
            <td>
            {if $ecriture.evenement=='A déterminer'}
                <select class="js-select-change" data-post-url="index.php?page=compta_journal&amp;action=modifier_colonne&amp;column=evenement&amp;id={$ecriture.idtmp}" style="width: 130px">
                    {foreach from=$events item=event_name key=event_id}
                    <option value="{$event_id}">{$event_name}</option>
                    {/foreach}
                </select>
            {else}
                {$ecriture.evenement}
            {/if}
            </td>
             <td>
                {if $ecriture.categorie=='A déterminer'}
                <select class="js-select-change" data-post-url="index.php?page=compta_journal&amp;action=modifier_colonne&amp;column=categorie&amp;id={$ecriture.idtmp}" style="width: 130px">
                    {foreach from=$categories item=cat_name key=cat_id}
                    <option value="{$cat_id}">{$cat_name}</option>
                    {/foreach}
                </select>
                {else}
                    {$ecriture.categorie}
                {/if}
             </td>
             <td  width="250">
                 {$ecriture.description|paybox_link}
             </td>
		{if $ecriture.idoperation == 1}
			<td  align='right' width='100'>-{$ecriture.montant|number_format:2:',':' '}</td>
			<td width='100'></td>
		{else}
			<td width='100'></td>
			<td align='right' width='100'>+{$ecriture.montant|number_format:2:',':' '}</td>
		{/if}

            <td>
            {if $ecriture.reglement=='A déterminer'}
                <select class="js-select-change" data-post-url="index.php?page=compta_journal&amp;action=modifier_colonne&amp;column=reglement&amp;id={$ecriture.idtmp}">
                    {foreach from=$payment_methods item=method_name key=method_id}
                    <option value="{$method_id}">{$method_name}</option>
                    {/foreach}
                </select>
            {else}
                {$ecriture.reglement}
            {/if}
            </td>
            <td align="center">
                <input
                    type="checkbox" class="js-attachment-change"
                    data-post-url="index.php?page=compta_journal&amp;action=modifier_colonne&amp;column=attachment_required&amp;id={$ecriture.idtmp}"
                    value="1"
                    {if $ecriture.attachment_required}checked{/if}
                />
                <a
                    {if !$ecriture.attachment_filename}style="display:none;"{/if}
                    class="js-has-attachment"
                    href="index.php?page=compta_journal&amp;action=download_attachment&amp;id={$ecriture.idtmp}"
                    title="Télécharger le justificatif"
                >
                    <img src="{$chemin_template}images/famfamfam/attach.png" alt="Attach" />
                </a>
                <div class="js-attachment-form-container" {if !$ecriture.attachment_required}style="display:none;"{/if}>
                    <form action="index.php?page=compta_journal&amp;action=upload_attachment&amp;id={$ecriture.idtmp}"
                          class="js-dropzone dz-journal-form"
                          style="display:none;"
                          ><img src="{$chemin_template}images/famfamfam/arrow_down.png" class="dz-message"/></form>
                </div>
            </td>
            <td style="text-align: right" class="single line">
                <a class="js-edit-comment compact ui icon button"
                   style="cursor:pointer;"
                   data-position="left center"
                   data-tooltip="Editer le commentaire"
                   data-post-url="index.php?page=compta_journal&amp;action=modifier_colonne&amp;column=comment&amp;id={$ecriture.idtmp}"
                   data-comment="{$ecriture.comment}">
                        <i class="comment {if $ecriture.comment}{else}outline{/if} icon"></i>
                </a>

                <a href="index.php?page=compta_journal&amp;action=modifier&amp;id={$ecriture.idtmp}"
                   data-position="left center"
                   data-tooltip="Modifier la ligne {$ecriture.description}"
                   class="compact ui icon button"
                >
                    <i class="pencil alternate icon"></i>
                </a>

                <a href="#"
                   data-position="left center"
                   data-tooltip="Ventiler la fiche de {$ecriture.description}"
                   class="compact ui icon button"
                   onclick="javascript:ventiler({$ecriture.idtmp}, {$ecriture.montant});return false;"
                >
                    <i class="calculator icon"></i>
                </a>

                <a href="index.php?page=compta_journal&amp;action=supprimer&amp;id={$ecriture.idtmp}"
                   data-position="left center"
                   data-tooltip="Supprimer la fiche de {$ecriture.description} "
                   class="compact ui red icon button confirmable"
                   data-confirmable-label="Etes-vous sûr de vouloir supprimer la fiche de {$ecriture.description} ?"
                >
                    <i class="trash icon"></i>
                </a>

            </td>
        </tr>
    {foreachelse}
        <tr>
            <td><em>Aucune ecriture actuellement</em></td>
        </tr>
    {/foreach}
     </table>
    </div>

    <div class="js-dz-preview-template" style="display:none;">
        <div class="dz-preview"></div>
    </div>

    <div class="js-upload-loader upload-loader" style="display: none;">
        <img class="loader" src="{$chemin_template}images/ajax-loader.gif" alt="Loading…" />
    </div>

    <!-- Required for paybox popups -->
    <meta name="referrer" content="no-referrer" />

{else}
    {if $action == 'importer'}
        <h2>Importer un fichier</h2>
    {elseif $action == 'ajouter'}
        <h2>Ajouter une écriture (facture)</h2>
    {else}
        <h2>Modifier une écriture (facture)</h2>
    {/if}
    {include file="formulaire.html"}
{/if}
