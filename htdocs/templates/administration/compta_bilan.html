<h2>Bilan</h2>

<div class="ui green segment">
    <form method="GET" name="evnt">
        <input type="hidden" name="page" value="compta_bilan" />
        <div class="ui form">
            <div class="inline fields">
                <div class="field">
                    <label>Année comptable</label>
                    <select name="id_periode" onchange="this.form.submit(); return false;">
                        {foreach from=$listPeriode item=periode}
                        <option value="{$periode.id}"{if $id_periode == $periode.id} selected{/if}>{$periode.date_debut} - {$periode.date_fin}</option>
                        {/foreach}
                    </select>
                </div>
            </div>
        </div>
    </form>
</div>

{if $action == 'lister'}
    <table class="ui table striped very compact celled">
            <thead>
                <tr>
                    <th class="center aligned">Débit</th>
                    <th class="center aligned">Crédit</th>
                </tr>
            </thead>
        <tbody>
            <tr>
                <td class="top aligned">
                    <table class="ui table striped very compact celled">
                        <thead>
                            <tr>
                                <th>Evenement</th>
                                <th class="right aligned">Montant</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            {foreach from=$debit item=debits}
                                <tr>
                                    <td>{$debits.evenement}</td>
                                    <td class="right aligned">{$debits.montant|number_format:2:',':' '}</td>
                                    <td class="right aligned">
                                        <a href="index.php?page=compta_bilan&amp;action=modifier&amp;details={$debits.id}&amp;id_periode={$smarty.get.id_periode}"
                                           data-tooltip="Déplier les écritures de débit/crédit pour {$debits.evenement}"
                                           data-position="left center"
                                           class="compact ui icon button">
                                            <i class="expand icon"></i>
                                        </a>
                                        <a href="index.php?page=compta_bilan&amp;action=view&amp;details={$debits.id}&amp;id_periode={$smarty.get.id_periode}"
                                           data-tooltip="Voir le détail des écritures de débit/crédit pour {$debits.evenement}"
                                           data-position="left center"
                                           class="compact ui icon button">
                                            <i class="eye icon"></i>
                                        </a>
                                    </td>
                                </tr>
                                {if ($smarty.get.details==$debits.id) }
                                    <tr>
                                        <td colspan='2'>
                                            <table class="ui table striped compact celled">
                                                <thead>
                                                    <tr>
                                                        <th>Date ecriture</th>
                                                        <th>Description</th>
                                                        <th class="right aligned">Montant</th>
                                                        <th>&nbsp;</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {foreach from=$dataDetailsDebit item=detail}
                                                        <tr>
                                                            <td>{$detail.date_ecriture|date_format:"%d/%m/%Y"}</td>
                                                            <td>{$detail.description}</td>
                                                            <td class="right aligned">{$detail.montant|number_format:2:',':' '}</td>
                                                            <td class="right aligned">
                                                                <a href="index.php?page=compta_journal&amp;action=modifier&amp;id={$detail.compta_id}"
                                                                   data-tooltip="Modifier la ligne {$detail.description}"
                                                                   data-position="left center"
                                                                   class="compact ui icon button">
                                                                    <i class="pencil alernate icon"></i>
                                                                </a>
                                                            </td>
                                                        </tr>
                                                    {foreachelse}
                                                    <tr>
                                                        <td><em>Aucune ecriture actuellement</em></td>
                                                    </tr>
                                                    {/foreach}
                                                </tbody>
                                            </table>
                                        </td>
                                        <td></td>
                                    </tr>
                                {/if}
                            {foreachelse}
                                <tr>
                                    <td><em>Aucune ecriture actuellement</em></td>
                                </tr>
                            {/foreach}
                        </tbody>
                    </table>
                </td>
                <td class="top aligned">
                    <table class="ui table striped compact celled">
                        <thead>
                            <tr>
                                <th>Evenement</th>
                                <th></th>
                                <th>Montant</th>
                            </tr>
                        </thead>
                        <tbody>
                            {foreach from=$credit item=credits}
                                <tr>
                                    <td>{$credits.evenement}</td>
                                    <td class="right aligned">{$credits.montant|number_format:2:',':' '}</td>
                                    <td class="right aligned">
                                        <a href="index.php?page=compta_bilan&amp;action=modifier&amp;details={$credits.id}&amp;id_periode={$smarty.get.id_periode}"
                                           data-tooltip="Déplier les écritures de crédit/crédit pour {$debits.evenement}"
                                           data-position="left center"
                                           class="compact ui icon button"
                                        >
                                            <i class="expand icon"></i>
                                        </a>
                                        <a href="index.php?page=compta_bilan&amp;action=view&amp;details={$credits.id}&amp;id_periode={$smarty.get.id_periode}"
                                           data-tooltip="Voir le détail des écritures de débit/crédit pour {$debits.evenement}"
                                           data-position="left center"
                                           class="compact ui icon button"
                                        >
                                            <i class="eye icon"></i>
                                        </a>
                                    </td>
                                </tr>
                                {if ($smarty.get.details==$credits.id) }
                                    <tr>
                                        <td colspan='2'>
                                            <table class="ui table striped very compact celled">
                                                <thead>
                                                    <tr>
                                                        <th>Date ecriture</th>
                                                        <th>Descritpion</th>
                                                        <th class="right aligned">Montant</th>
                                                        <th>&nbsp;</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {foreach from=$dataDetailsCredit item=detail}
                                                        <tr>
                                                            <td>{$detail.date_ecriture|date_format:"%d/%m/%Y"}</td>
                                                            <td>{$detail.description}</td>
                                                            <td class="right aligned">{$detail.montant|number_format:2:',':' '}</td>
                                                            <td class="right aligned">
                                                                <a href="index.php?page=compta_journal&amp;action=modifier&amp;id={$detail.compta_id}"
                                                                   data-tooltip="Modifier la ligne {$detail.description}"
                                                                   data-position="left center"
                                                                   class="compact ui icon button">
                                                                    <i class="pencil alernate icon"></i>
                                                                </a>
                                                            </td>
                                                        </tr>
                                                    {foreachelse}
                                                        <tr>
                                                            <td><em>Aucune ecriture actuellement</em></td>
                                                        </tr>
                                                    {/foreach}
                                                </tbody>
                                            </table>
                                        </td>
                                        <td></td>
                                    </tr>
                                {/if}
                            {foreachelse}
                                <tr>
                                    <td><em>Aucune ecriture actuellement</em></td>
                                </tr>
                            {/foreach}
                        </tbody>
                    </table>
                </td>
            </tr>
            <tr>
                <td class="center aligned">{$totalDepense|number_format:2:',':' '}</td>
                <td class="center aligned">{$totalRecette|number_format:2:',':' '}</td>
            </tr>
            <tr>
                <td colspan="2"  class="center aligned">{$difMontant|number_format:2:',':' '}</td>
            </tr>
        </tbody>
    </table>

{elseif $action == 'view'}
<br />
  <img src="{$chemin_template}images/puce.png" class="puce" alt="Puce" /><a href="index.php?page=compta_bilan&amp;action=lister&id_periode={$smarty.get.id_periode}" title="retour bilan">Retour au bilan</a><br />
<br />
    <table><tr><td align="center">Débit

        <table class="ui table striped compact celled">
        <tr>
            <th>Date ecriture</th>
            <th>Descritpion</th>
            <th>Montant</th>
            <th>&nbsp;</th>
       </tr>

	    {foreach from=$dataDetailsDebit item=detail}
        <tr class="{cycle values="odd,even"}">
            <!-- td width="20px"><input type="checkbox" value=""/></td -->
            <td>{$detail.date_ecriture|date_format:"%d/%m/%Y"}</td>
            <td>{$detail.description}</td>
			<td align='right'>{$detail.montant|number_format:2:',':' '}</td>

        </tr>

    {foreachelse}
        <tr>
            <td><em>Aucune ecriture actuellement</em></td>
        </tr>
    {/foreach}
   	</table>

	</td><td align="center" valign="top">Crédit
        <table class="ui table striped compact celled">
        <tr>
            <th>Date ecriture</th>
            <th>Descritpion</th>
            <th>Montant</th>
            <th>&nbsp;</th>
       </tr>

	    {foreach from=$dataDetailsCredit item=detail}
        <tr class="{cycle values="odd,even"}">
            <!-- td width="20px"><input type="checkbox" value=""/></td -->
            <td>{$detail.date_ecriture|date_format:"%d/%m/%Y"}</td>
            <td>{$detail.description}</td>
			<td align='right'>{$detail.montant|number_format:2:',':' '}</td>

        </tr>


    {foreachelse}
        <tr>
            <td><em>Aucune ecriture actuellement</em></td>
        </tr>
    {/foreach}
   	</table>

	<tr>
	<th align='center'>{$sousTotalDebit|number_format:2:',':' '}</th>
	<th align='center'>{$sousTotalCredit|number_format:2:',':' '}</th>
	</tr>
	<tr>
        <th colspan='2'  align='center'>{$difMontant|number_format:2:',':' '}</th>
    </tr>
	</td></tr>

    </table>


{else}

{/if}
